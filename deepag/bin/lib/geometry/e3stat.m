function y = e3stat(x,X1,X2,s,n) 
%
% x2 = e3stat(x1,X1,X2[,s,n]) - transform x1 into x2 by [n] transoforms generated by perturbed X1, X2  
%
% x1, X1, X2 ... 3 x n matrices of points in columns
% s          ... sigma of N(0,s) noise os size 3 x n added  X1, X2
%            ... size(s) = [1 1]: N = s*eye(3)*randn(3,n)
%            ... size(s) = [3 1]: N = diag(s)*randn(3,n)
% x2         ... x2(:,i) = E{i}(x1) with E(i) = [R(i) t(i);0 0 0 1]  
%                          [R(i) t(i)] = argmax_{R,t} ||X2+N(i)-R*(X1+t)||

% pajdla@ciirc.cvut.cz
% 2015-06-01
if nargin>0
    if nargin<5, n = 100; end
    if nargin<4, s = 1; end
    if size(s)==[1 1], s = [s;s;s]; end
    y = zeros(3,n);
    for i=1:n
        % noise
        N = diag(s)*randn(size(X1));
        % optimal euclidean fit
        E = azose3fit(X1,X2+N);
        y(:,i) = E(1:3,1:3)*x+E(1:3,4);
    end
else % demo
    X1 = [ 0 5  0; -10 0 10; 0 0 0];
    X2 = X1;
    x  = [100;0;0];
    y = e3stat(x,X1,X2,1,1000);
    figure;
    plot3(X1(1,:),X1(2,:),X1(3,:),'.k');hold
    plot3(X2(1,:),X2(2,:),X2(3,:),'ok');
    plot3(y(1,:),y(2,:),y(3,:),'.g');
    plot3(x(1),x(2),x(3),'.b','markersize',20);
    axis equal; grid
    title('A radom tranform randomly perturbed generates the green points from the blue one')
end
